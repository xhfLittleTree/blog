---
title: 内存泄漏问题
date: 2023-12-06 10:59:01
permalink: /pages/20231206105901/
categories:
  - 学习
tags:
  - null
---

## 遇到问题

页面运行过程中，随着使用时间的增长，页面操作越来越卡，并且会出现白屏和崩溃的情况

## 确定是否存在内存泄漏

抓取内存快照进行对比来确定和排查内存泄漏相关情况

## 常见的内存泄漏常见

1. 未移除的监听事件

当我们使用`addEventListener`进行事件监听时，在不需要的时候应当使用`removeEventListener`来移除监听

2. 全局变量

当我们定义了全局变量时在`window`上挂载变量时，变量在页面销毁前一直存在，我们应该避免定义全局变量，或者不使用时将此变量设置为空

3. 未注销的observer

当我们使用`MutationObserver`或者`ResizeObserver`时，在不需要的时候应当使用`disconnect`方法来取消监听

4. 未移除的dom元素

当我们使用`getElementById`或者`querySelector`等方法获取dom元素并将其赋值给某个变量时，在不需要时需要将此变量设置为空，避免当我们`removeChild`后此dom元素依旧存在内存中

5. 未移除的计时器

当我们使用`setTimeout`和`setInterval`时，在不需要时应该`clearTimeout`和`clearInterval`,`setTimeout`和`setInterval`时并不一定会导致内存泄漏，但是及时clear会避免内存泄漏的出现

6. 闭包中变量

当一个函数A中定义了函数B，B中使用了函数A中声明的变量，在执行函数A结束时，应该将此变量设置为空

7. 未移除的事件订阅

在vue中，当我们使用`$on`进行事件订阅后，在不需要时应该使用`$off`取消事件的订阅

8. 未销毁的vue实例

在vue中，创建两个vue实例，将他们的dom通过`appendChild`等方式联系在一起，但是并没有创建两个vue实例的父子关系，当调用`removeChild`销毁时，需要调用`$destroy`将相对应的vue实例销毁

9. iframe的onload事件

交易中使用iframe.onload方法，改成document.addEventListener('load',XXX),在退出时使用document.removeEventListener('load',XXX)来销毁

