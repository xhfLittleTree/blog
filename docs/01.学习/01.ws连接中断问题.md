---
title: ws连接中断问题
date: 2023-09-11 10:59:00
permalink: /pages/20230911105900/
categories:
  - 学习
tags:
  - null
---

## 遇到问题

项目的客户端和服务器之间有ws长连接,当执行某些业务操作时，需要通过ws的readyState属性去获取ws的连接状态,当ws连接时发送ws请求,ws连接断开时给与提示
现在发现当客户端网络出现问题中断时,获取ws的readyState仍然为true,但是此时ws请求已经无法发送了

## 排查原因

当客户端主动调用ws的close方法时，readyState的值会直接发生变化
而当网络中断时，readyState值的并没有实时变化，而是等到onclose回调触发后才会变化

## 解决方法

增加心跳机制, 客户端向服务端发送心跳, 当客户端在若干时间后未收到心跳回复则认为连接断开，主动调用close方法，并触发重连。
